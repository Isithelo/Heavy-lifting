var heavyliftingModel      = require('../models/heavylifting.js');
var siteName = 'Heavy-lifting'
var ObjectId = require('mongodb').ObjectID;


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Page Controllers - rebuild


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Middelware -  Limit to 1 query.


////////////////////////////////////////////////////
////       POULATE THE CONTRIBUTION GRAPH      //// 
///////////////////////////////////////////////////
exports.heavyliftingalluser = function(req, res, next) {
//verify the string query.
if (req.user) {
  var query1 = heavyliftingModel.find(
  {
    "userID": req.user.id}
    )
  query1.exec(function (err, query1_return) {
    if(err){console.log('Error Here'); return;} 
//autopoulate the elementID
if(query1_return){
  for (var i = 0; i < query1_return.length; i++) {
        //the menu item elementid should arrive poulated to avoid confusion.
        if(query1_return[i].elementID==''){
          query1_return[i].elementID=query1_return[i]._id
        }
      }
    } else {
      console.log('query1_return failed')
    } 
    req.items = query1_return
    req.itemsParse = JSON.stringify(query1_return)
    next();
  })
} else {
  next();
}
}