

<div class="row">
  <div class="col-md-6"><h1 id="Description"></h1></div>
   </div>
</div>

 

<div style="padding-bottom: 15px">

  <div id="detail"></div>
</div>

<div id="loading"></div>


  


<div class="btn-group" role="group" aria-label="..." style="padding-bottom: 15px">
  <button type="button" class="btn btn-default" id="newForm" data-toggle="modal" data-target="#myModal"> New Entry</button> 
</div>
<hr>

<div style="padding-top: 15px"></div>
<div id="long"></div>
<div style="padding-bottom: 15px"></div>
<script type="text/javascript">

//  var tablelistdata = {{{data}}};
//  var items = {{{items}}}
 
  $(document).ready(function() {


    var tempVarID = 'blablabla'

/*

    $('#Description').html(items.Description)
    $('#detail').html(items.Detail)
    $('#long').html(items['Long Description'])
//inject the ID html table into the page.
$('#loading').html('<table id="'+tempVarID+'" class="table table-bordered table-compressed table-hover" cellspacing="0" width="100%"></table>')




//error message text
var html = ''
html += '<div class="alert alert-danger" role="alert"> '
html += '<strong>'
html += 'Oh snap!'
html += '</strong> '
html += 'Table error , Please let us know about this.'
html += '</div>'

//client side error check for the tables.
if (tablelistdata !== null) {
  if (tablelistdata.length !== 0) {
    dataTableLoad (tablelistdata,tempVarID,items.headings)
    loadDataTable(tempVarID)
  } else {
    $('#loading').html(html)
  }
} else {
  $('#loading').html(html)
}
*/

});


  function loadDataTable(id){
    table = jQuery('#'+id).DataTable({
      'destroy':true,
      "pagingType": "numbers",
//  'order': [[ 2, 'asc' ]] ,
});

//Add event listener for opening and closing details
jQuery('#'+id +' tbody').on('click', 'td.details-control', function () {
  var tr = jQuery(this).closest('tr');
  var row = table.row( tr );
  if ( row.child.isShown() ) {
// This row is already open - close it
row.child.hide();
tr.removeClass('shown');
}
else {
// Open this row
//it is async , and the canvas is not rendered 
row.child(formatDefault(this.id))
row.child.show();
tr.addClass('shown');
}
});


////////////////////////////////////////////////////////////////////
////////////        FORMIDABLE VIEW EXTRA DETAIL         ///////////
///////////////////////////////////////////////////////////////////
function formatDefault ( d ) {
 
// `d` is the original data object for the row
var html=''
html='<h4>Options</h4>'
html += '<div id="'+d+'_content" style="padding-top:0px;text-align:left">'

html += '<div class="btn-group" role="group" aria-label="..." style="padding-bottom:15px;padding-right:15px">'
html += '<button type="button" class="btn btn-info" data-toggle="tooltip" data-placement="top" title="Use this as Default." id="'+d+'" onclick="">Request a change</button>'
html += '</div>'

html += '<div class="btn-group" role="group" aria-label="..." style="padding-bottom:15px">'
html += '<button type="button" class="btn btn-default" id="'+d+'" onclick="readDatabase(this.id)"  data-toggle="modal" data-target="#myModal" data-toggle="tooltip" data-placement="top" title="Edit ths item.">Modify</button>'
  html += '<button type="button" class="btn btn-default" data-_id="'+d+'" id="'+d+'_downloadlink" data-toggle="modal" data-target="#myModal" onclick="deleteEntry(this.id)"  data-toggle="tooltip" data-placement="top" title="Delete this item">Delete</button>'
html += '</div>'
html += '</div>'
html += '<div id="'+d+'_loadingArea" ></div>'
loadDetail(d)
return html;

}

}



///////////////////////////////// 
//////  DELETE CONVEYOR  ///////
/////////////////////////////// 
 function deleteEntry(id){
 $('#myModalLabel').html('Delete Entry')
_id = $( "#"+id ).data( "_id" )  
html = ''
html +='<div class="row" style="width:100%;text-align:center">'
html +='<i class="fa fa-question-circle fa-4x" aria-hidden="true" ></i>'
html += '<h3>Are you sure you what to do this ?</h3>'
html += '<p>This action cannot be undone.</p>'
html +='<div class="btn-group" role="group" aria-label="..." style="align:center">'
html +='  <button type="button" class="btn btn-danger" onclick="deleteEntrys('
html +="'"
html +=_id
html +="'"
html +=')">Confirm</button>'
 
html +='</div>'
 $('#formRenders').html(html)
}

function deleteEntrys(_id){
  //always create at the selected node
  var json = {
    '_id' : _id,
  }
  jQuery.ajax({
    'url': '/deleteDbentry',
    'type': 'POST', 
    'contentType': 'application/json', 
    'data': JSON.stringify(json),
    'success': function ( ) {
      
         window.location = '/database'
    }  
  })
}

function loadDetail(id){
  var html = '<div style="text-align:center">'
  html += '<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>'
  html+='<span class="sr-only">Loading...</span>'
  html += '</div>'
  $('#'+id+'_loadingArea').html(html)
  jQuery.ajax({
    'async': true,
    'global': false,
    'url': '/getlongdata?data='+id,
    'success': function (dataSchemaObject) {
      $('#'+id+'_loadingArea').html(dataSchemaObject)
    }
  });
}

////////////////////////////
////////    READ  /////////
///////////////////////////
function dataTableLoad (data,id,headings){
  html = ''
  html += '<thead><tr><th  style="width:1px"></th>'
  for (var i = 0; i < headings.length; i++) {
    html += '<th>'
    html+=headings[i]
    html += '</th>'
  }
  html += '</tr></thead>'
  html += '<tbody>'
  for (var i = 0; i < data.length; i++) {
    html += '<tr><td class="details-control" style="text-align:center;vertical-align:middle; " id="'+data[i]['_id']+'"><i class="fa fa-plus-square-o" aria-hidden="true" ></i></td>'
    for (var j = 0; j < headings.length; j++) {
      html += '<td style=" vertical-align:middle">'
      html += data[i][headings[j]]
      html += '</td>'
    }
    html += '</tr>'
  }
  html += '<tbody>'
  $('#'+id).html(html)
} 

//////////////////////////////////////////////
////////    BUTTON CLICK OPEN FORM  /////////
////////////////////////////////////////////
$('#newForm').click(function(){
  //This is hard wired , and likely to cause issues.
  loadformatedinfo('5890328e1cb2584e38099333','','use')
})

//////////////////////////////////////
////////    GET FORM BY ID  /////////
////////////////////////////////////
function loadformatedinfo(formdata,idItem,raw){
  jQuery.ajax({
    'url': '/getform?formdata='+formdata+'&idItem='+idItem+'&raw='+raw,
    'async': true,
    'global': false,
    'success': function (dataSchemaObject) {
      $('#formArea').html(dataSchemaObject)
   }
 });
}

///////////////////////////////// 
//////  READ CONVEYOR     //////
/////////////////////////////// 
function readDatabase(id){
  $('#myModalLabel').html('Modify Conveyor')
  jQuery.ajax({
    'async': true,
    'global': false,
    'url': '/readDatabase?data='+id,
    'success': function (dataSchemaObject) {
      $('#formRenders').html(dataSchemaObject)
      var temp = dataSchemaObject
    }
  });
}

///////////////////////////////// 
//////  DELETE CONVEYOR  ///////
/////////////////////////////// 
function deleteConveyormodal(id){
  $('#myModalLabels').html('Delete Conveyor')
  _id = $( "#"+id ).data( "_id" )  
  html = ''
  html +='<div class="row" style="width:100%;text-align:center">'
  html +='<i class="fa fa-question-circle fa-4x" aria-hidden="true" ></i>'
  html += '<h3>Are you sure you what to do this ?</h3>'
  html += '<p>This action cannot be undone.</p>'
  html +='<div class="btn-group" role="group" aria-label="..." style="align:center">'
  html +='  <button type="button" class="btn btn-danger" onclick="deleteConveyor('
  html +="'"
  html +=_id
  html +="'"
  html +=')">Confirm</button>'

  html +='</div>'
  $('#formRenders').html(html)
}

function deleteConveyor(_id){
//always create at the selected node
var json = {
  '_id' : _id,
}
jQuery.ajax({
  'url': '/deletecv',
  'type': 'POST', 
  'contentType': 'application/json', 
  'data': JSON.stringify(json),
  'success': function (redirectTo) {
    console.log(redirectTo)
    window.location = redirectTo.redirectTo;
  }  
})
}
$(function () {
  $('[data-toggle="tooltip"]').tooltip()
})
</script>