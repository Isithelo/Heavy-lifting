 
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Modal title</h4>
      </div>
      <div class="modal-body">
        <div id="modal-body"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
 
<p></p>
<div>
  <label class="checkbox-inline">
  <input type="checkbox" id="toggle-event"   data-toggle="toggle" data-on='<span class="glyphicon glyphicon-time" aria-hidden="true"></span> ' data-off='<span class="glyphicon glyphicon-time" aria-hidden="true"></span>'  data-onstyle="default"> Revision History
  </label>
</div>
<p></p>

<div class="row">
  <div class="col-md-6">
        <div class="panel panel-default">
  <div class="panel-body">
    <div id="loading">
  <table id="tableComps" class="table table-bordered table-compressed table-hover" cellspacing="0" width="100%"></table>
</div>  
  </div>
</div>


  </div>
  <div class="col-md-6">
    <div class="panel panel-default">
  <div class="panel-body">
     <div id="formArea"></div>
  </div>
</div>

  </div>
</div>


<script type="text/javascript">
var objectType = "{{objectType}}"


 
/////////////////////////////////////////////////////////////////////////////
////////  EVENT LISTNER ON THE TOOGGLE FOR REMOVING THE COMPONETNS   ///////
///////////////////////////////////////////////////////////////////////////
$('#toggle-event').change(function() {
  //This function is defined in the component navigation template.
  getCollectionData(objectType,$('#toggle-event').prop('checked'))
})

///////////////////////////// 
//////  INITIALISE    //////
/////////////////////////// 
$('document').ready(function(){
 getCollectionData(objectType)
})


///////////////////////////////
//////  GET THE TABLE   //////
/////////////////////////////
function getCollectionData(objectType,toggle){
  jQuery.ajax({
    'url': '/getCollectionData?objectType='+objectType+'&showall='+toggle,
    'async': true,
    'global': false,
    'success': function (dataSchemaObject) {
    tablelistdata = jQuery.parseJSON( dataSchemaObject );
    tableload(tablelistdata)
   }
 }); 
}

///////////////////////////////
//////  LOAD THE TABLE  //////
/////////////////////////////
function tableload(tablelistdata) {
  var tempVarID = 'inputtable'
  var headings =  ['name'  ]//,'userID']
//inject the ID html table into the page.
$('#loading').html('<table id="'+tempVarID+'" class="table table-bordered table-compressed table-hover" cellspacing="0" width="100%"></table>')
//error message text
var html = ''
html += '<div class="alert alert-danger" role="alert"> '
html += '<strong>'
html += 'Oh snap!'
html += '</strong> '
html += 'Table error , Please let us know about this.'
html += '</div>'
//client side error check for the tables.
if (tablelistdata !== null) {
  if (tablelistdata.length !== 0) {
    dataTableLoad (tablelistdata,tempVarID,headings)
    loadDataTable(tempVarID)
  } else {
    $('#loading').html(html)
  }
} else {
  $('#loading').html(html)
}
};

//////////////////////////////////////
////////    HTML FOR TABLE  /////////
////////////////////////////////////
function dataTableLoad (data,id,headings){
  html = ''
  html += '<thead><tr>'
  for (var i = 0; i < headings.length; i++) {
    html += '<th>'
    html+=headings[i]
    html += '</th>'
  }
  html += '<th  style="width:1px"></th></tr></thead>'
  html += '<tbody>'
  for (var i = 0; i < data.length; i++) {
    html += '<tr>'
    for (var j = 0; j < headings.length; j++) {
      html += '<td style=" vertical-align:middle">'
      html += data[i][headings[j]]
      html += '</td>'
    }
    html += '<td class="details-control" style="text-align:center;vertical-align:middle;min-width:220px "  >'
    html +='<div class="btn-group" role="group" aria-label="...">'
    html += '<button type="button" class="btn btn-default"  id="'+data[i]['_id']+'_use">Use</button>'
    html += '<button type="button" class="btn btn-default"  id="'+data[i]['_id']+'_edit">Edit</button>'
    html += '<button type="button" class="btn btn-default"  id="'+data[i]['_id']+'_raw">Raw</button>'
    html += '<button type="button" class="btn btn-danger"  id="'+data[i]['_id']+'_delete" data-toggle="modal" data-target="#myModal">Delete</button>'
    html +='</div>'
    html += '</td>'
    html += '</tr>'
  }
  html += '<tbody>'
  $('#'+id).html(html)
} 


/////////////////////////////////////
//////  ACTIVATE DATATABLES   //////
///////////////////////////////////
function loadDataTable(id){
  table = jQuery('#'+id).DataTable({
    'destroy':true,
    "pagingType": "numbers",
//  'order': [[ 2, 'asc' ]] ,
});
//Add event listener for opening and closing details
jQuery('#'+id +' tbody').on('click', 'td div button', function () {
var ids = this.id
switch(true){
  case(ids.search("_use") >1):
    ids = ids.replace("_use","");
    loadformatedinfo(ids,'','true')
  break;
  case(ids.search("_edit") >1):
    ids = ids.replace("_edit","");
    editDataentry('587b4de03ed9ea24e459f953',ids)
  break;
  case(ids.search("_raw") >1):
    ids = ids.replace("_raw","");
    editDataRaw('587b51ee3ed9ea24e459f954',ids,'true')
  break;  
  case(ids.search("_delete") >1):
    ids = ids.replace("_delete","");
    deleteEntryModal(ids)
  break;   
}
});
 }

//////////////////////////////////////
////////    GET FORM BY ID  /////////
////////////////////////////////////
function loadformatedinfo(formdata,idItem,raw){
  jQuery.ajax({
    'url': '/getform?formdata='+formdata+'&raw='+raw ,
    'async': true,
    'global': false,
    'success': function (dataSchemaObject) {
 	    $('#formArea').html(dataSchemaObject)
   }
 });
}

////////////////////////////////////////
////////    EDIT THE RAW DATA /////////
//////////////////////////////////////
function editDataRaw(formdata,idItem,raw){
   jQuery.ajax({
    'url': '/getform?formdata='+formdata+'&idItem='+idItem+'&raw='+raw,
    'async': true,
    'global': false,
    'success': function (dataSchemaObject) {
    $('#formArea').html(dataSchemaObject)
   }
 });
}

////////////////////////////////////////////////
////////    EDIT ONLY THE ENTRY DATA  /////////
//////////////////////////////////////////////
function editDataentry(formdata,idItem,raw){
   jQuery.ajax({
    'url': '/getform?formdata='+formdata+'&idItem='+idItem,
    'async': true,
    'global': false,
    'success': function (dataSchemaObject) {
    $('#formArea').html(dataSchemaObject)
   }
 });
}

///////////////////////////////// 
//////  DELETE ENTRY     ///////
/////////////////////////////// 
function deleteEntryModal(id){
  $('#myModalLabel').html('Delete Data')
  html = ''
  html +='<div class="row" style="width:100%;text-align:center">'
  html +='<i class="fa fa-question-circle fa-4x" aria-hidden="true" ></i>'
  html += '<h3>Are you sure you what to do this ?</h3>'
  html += '<p>This action cannot be undone.</p>'
  html +='<div class="btn-group" role="group" aria-label="..." style="">'
  html +='  <button type="button" class="btn btn-danger" onclick="deleteEntryYes('
  html +="'"
  html +=id
  html +="'"
  html +=')">Confirm</button>'
  html +='</div>'
  html +='</div>'
  $('#modal-body').html(html)
}

////////////////////////////////////////////////
////////    EDIT ONLY THE ENTRY DATA  /////////
//////////////////////////////////////////////
function deleteEntryYes(idItem){
   jQuery.ajax({
    'url': '/deleteentry?idItem='+idItem,
    'async': true,
    'global': false,
    'success': function (dataSchemaObject) {
    $('#formArea').html(dataSchemaObject)
   }
 });
}

////////////////////////////////////////////////////
////////    LOAD THE PRE PANEL WITH JSON  /////////
//////////////////////////////////////////////////
function loadDetail(id){
for (var i = 0; i < tablelistdata.length; i++) {
  if (tablelistdata[i]['_id'] == id){
    var str = JSON.stringify(tablelistdata[i], null, 2);
      return  '<pre style="overflow:auto;max-width:550px;max-height:350px">'+str+'</pre>'
  }
}
}

 


</script>
